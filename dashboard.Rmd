---
title: "NYC Restaurant Inspection Dashboard"
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    theme: cerulean
runtime: shiny
---

```{r setup, include=FALSE}
library(p8105.datasets)
library(tidyverse)
library(plotly)
library(lubridate)
library(janitor)
library(flexdashboard)
library(forcats)
library(stringr)

nyc_rest <- rest_inspec |>
  clean_names() |>
  mutate(
    inspection_date = ymd(inspection_date),
    year = year(inspection_date),
    grade = factor(grade, levels = c("A", "B", "C", "P", "Z", "Not Yet Graded"))
  )
```

## Top Cuisines
```{r}
top_cuisines <- nyc_rest |>
  count(cuisine_description, sort = TRUE) |>
  slice_head(n = 10) |>
  mutate(
    cuisine_description = str_wrap(cuisine_description, width = 15),
    cuisine_description = forcats::fct_reorder(cuisine_description, n)
  )

plot_ly(
  top_cuisines,
  y = ~cuisine_description,
  x = ~n,
  type = "bar",
  orientation = "h",
  marker = list(color = "forestgreen")
) |>
  layout(
    xaxis = list(title = "Number of Inspections"),
    yaxis = list(title = "", automargin = TRUE)
  )
```

## Violations by Borough (with filter)
```{r}
nyc_rest |>
  filter(!is.na(score)) |>
  ggplot(aes(x = boro, y = score, fill = grade)) +
  geom_boxplot() +
  labs(
    x = "Borough",
    y = "Inspection Score (lower = better)",
    fill = "Grade"
  ) +
  theme_minimal()
```


## Score Distribution by Grade
```{r}
nyc_rest |>
  filter(!is.na(score), grade %in% c("A", "B", "C")) |>
  plot_ly(x = ~grade, y = ~score, type = "box") |>
  layout(yaxis = list(title = "Inspection Score"))
```



