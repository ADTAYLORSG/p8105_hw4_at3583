---
title: "NYC Restaurant Inspection Dashboard"
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    theme: cerulean
---

```{r setup, include=FALSE}
#Load Libraries
library(p8105.datasets)
library(tidyverse)
library(plotly)
library(lubridate)
library(janitor)
library(flexdashboard)
library(forcats)
library(stringr)

#Load and clean dataset
nyc_rest <- rest_inspec |>
  clean_names() |>
  mutate(
    inspection_date = ymd(inspection_date),
    year = year(inspection_date),
    grade = factor(grade, levels = c("A", "B", "C", "P", "Z", "Not Yet Graded"))
  )
```

## Top NYC Cuisines
```{r}
#Plot Top Cuisines NYC
top_cuisines <- nyc_rest |>
  count(cuisine_description, sort = TRUE) |>
  slice_head(n = 10) |>
  mutate(
    cuisine_description = str_wrap(cuisine_description, width = 35),
    cuisine_description = forcats::fct_reorder(cuisine_description, n)
  )

plot_ly(
  top_cuisines,
  y = ~cuisine_description,
  x = ~n,
  type = "bar",
  orientation = "h",
  marker = list(color = "teal")
) |>
  layout(
    title = "Top 10 Cuisines in NYC",
    xaxis = list(title = "Number of Inspections"),
    yaxis = list(title = "", automargin = TRUE)
  ) 
```

## Violations by Borough
```{r}
## Plot violations by borough
nyc_rest |>
  filter(!is.na(score)) |>
  ggplot(aes(x = boro, y = score, fill = grade)) +
  geom_boxplot() +
  labs(
    title = "Inspection Score Distribution by Borough",
    x = "Borough",
    y = "Inspection Score (lower = better)",
    fill = "Grade"
  ) +
  theme_minimal()
```

```{r}
# Score over time by grade
nyc_rest |>
  filter(!is.na(score)) |>
  sample_frac(0.05) |>  
  plot_ly(
    x = ~inspection_date,
    y = ~score,
    color = ~grade,
    type = "scatter",
    mode = "markers"
  ) |>
  layout(
    title = "Inspection Scores Over Time",
    xaxis = list(title = "Date"),
    yaxis = list(title = "Inspection Score (lower = better)")
  )
```







